---
layout: post
title: "pandas 기본 사용법 익히기"
description: "10 Minutes to pandas"
tags: [python, pandas, 10min]
share: true
comments: true
---

> 본 포스트는 pandas의 기본 사용법을 소개해 놓은 [10 Minutes to pandas](https://pandas.pydata.org/pandas-docs/stable/10min.html)을 따라 실습해 보면서 한글로 번역하고 추가설명을 달아 놓은 글입니다. pandas를 처음 익히시려는 분들께 도움이 되었으면 좋겠습니다.

pandas를 사용하기 위해서 관례적으로 다음과 같이 모듈을 임포트(import) 합니다. pandas 외에도 배열 구조나 랜덤 값 생성 등의 기능을 활용하기 위한 numpy와 그래프를 그리기 위한 matplotlib도 함께 임포트 해줍니다.

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
```

## 1. 데이터 오브젝트 생성하기

pandas에서 제공하는 자료 구조들이 무엇이 있는지 알아보시려면 pandas documentation에 있는 [Data Structure Intro section](https://pandas.pydata.org/pandas-docs/stable/dsintro.html#dsintro)을 참고하시면 됩니다.

pandas의 데이터 구조 중 하나인 **Series**는 다음과 같이 값들의 리스트를 넘겨주어 만들게 됩니다. 인덱스는 자동적으로 기본적으로 지정되는 정수 인덱스를 사용합니다.

```python
s = pd.Series([1, 3, 5, np.nan, 6, 8])

# 0    1.0
# 1    3.0
# 2    5.0
# 3    NaN
# 4    6.0
# 5    8.0
# dtype: float64
```

또 다른 데이터 구조인 **DataFrame**은 numpy array를 받아 생성이 가능합니다. 여기에서는 인덱스로 날짜 값을 주었고, 컬럼의 이름도 같이 넣어보았습니다.

```python
dates = pd.date_range('20130101', periods=6)
# DatetimeIndex(['2013-01-01', '2013-01-02', '2013-01-03', '2013-01-04',
#                '2013-01-05', '2013-01-06'],
#               dtype='datetime64[ns]', freq='D')

df = pd.DataFrame(np.random.randn(6,4), index=dates, columns=list('ABCD'))
#                   A         B         C         D
# 2013-01-01  0.469112 -0.282863 -1.509059 -1.135632
# 2013-01-02  1.212112 -0.173215  0.119209 -1.044236
# 2013-01-03 -0.861849 -2.104569 -0.494929  1.071804
# 2013-01-04  0.721555 -0.706771 -1.039575  0.271860
# 2013-01-05 -0.424972  0.567020  0.276232 -1.087401
# 2013-01-06 -0.673690  0.113648 -1.478427  0.524988
```

또는 다음과 같이 Series 처럼 변환 가능한 오브젝트들을 갖고 있는 dict의 형태를 인자로 넣어주어 DataFrame을 만들 수 있습니다. 이 때, index는 자동으로 0부터 시작하여 1씩 증가하는 정수 인덱스가 부여되고, dict의 키 값을 컬럼의 이름으로 사용하게 됩니다.

```python
df2 = pd.DataFrame({'A': 1.,
                    'B': pd.Timestamp('20130102'),
                    'C': pd.Series(1, index=list(range(4)), dtype='float32'),
                    'D': np.array([3]*4, dtype='int32'),
                    'E': pd.Categorical(['test', 'train', 'test', 'train']),
                    'F': 'foo'})
#      A          B    C  D      E    F
# 0  1.0 2013-01-02  1.0  3   test  foo
# 1  1.0 2013-01-02  1.0  3  train  foo
# 2  1.0 2013-01-02  1.0  3   test  foo
# 3  1.0 2013-01-02  1.0  3  train  foo
```

DataFrame의 컬럼들은 각기 특별한 자료형을 갖고 있습니다. 이는 DataFrame 내에 있는 dtypes라는 속성을 통해 확인 가능합니다. 파이썬의 기본적인 소수점은 float64로 잡히고, 기본적은 문자열은 str이 아니라 object라는 자료형으로 나타납니다.

```python
df2.dtypes
# A           float64
# B    datetime64[ns]
# C           float32
# D             int32
# E          category
# F            object
# dtype: object
```

IPython을 사용하시는 분이라면 `df2.<TAB>`('df2.'까지 입력하고 탭을 누름)을 통해 다음과 같이 dtypes 외에도 다른 속성들이 무엇이 있는지 확인할 수 있습니다.

```
In [13]: df2.<TAB>
df2.A                  df2.bool
df2.abs                df2.boxplot
df2.add                df2.C
df2.add_prefix         df2.clip
df2.add_suffix         df2.clip_lower
df2.align              df2.clip_upper
df2.all                df2.columns
df2.any                df2.combine
df2.append             df2.combine_first
df2.apply              df2.compound
df2.applymap           df2.consolidate
df2.as_blocks          df2.convert_objects
df2.asfreq             df2.copy
df2.as_matrix          df2.corr
df2.astype             df2.corrwith
df2.at                 df2.count
df2.at_time            df2.cov
df2.axes               df2.cummax
df2.B                  df2.cummin
df2.between_time       df2.cumprod
df2.bfill              df2.cumsum
df2.blocks             df2.D
```

보다시피 컬럼 A, B, C, D가 자동적으로 생성되어 나타나는 것을 확인할 수 있습니다. 나머지 속성들은 간결성을 위해 생략하였기 때문에 E도 뒤에 있을 것입니다.

Ipython을 사용하지 않는 분이라면, python의 빌트인 함수 `dir`을 통해 다음과 같이 오브젝트가 갖고 있는 속성들을 모두 확인 가능합니다. (약 400개가 넘는 항목입니다. 엄청 많습니다.)

```python
dir(df2)
# ['A', 'B', 'C', ... , 'values', 'var', 'where', 'xs']
```


## 2. 데이터 확인하기 (Viewing Data)

이 부분에 대해 더 자세히 알고 싶으시면 [Basics section](https://pandas.pydata.org/pandas-docs/stable/basics.html#basics)을 참고해주세요.

DataFrame에 들어있는 자료들을 확인하기 위해 맨 앞이나 뒤의 자료들 몇 개를 알아보고 싶다면 다음과 같이 `.head()`와 `.tail()` 메소드를 사용하면 됩니다. 기본적으로 5개의 자료를 보여주고, 더 적게 혹은 많이 보고 싶다면 메소드의 인자로 보고싶은 데이터의 개수를 숫자를 넣어주면 됩니다.

```python
df.head()
#                    A         B         C         D
# 2013-01-01  0.469112 -0.282863 -1.509059 -1.135632
# 2013-01-02  1.212112 -0.173215  0.119209 -1.044236
# 2013-01-03 -0.861849 -2.104569 -0.494929  1.071804
# 2013-01-04  0.721555 -0.706771 -1.039575  0.271860
# 2013-01-05 -0.424972  0.567020  0.276232 -1.087401

df.tail(3)  # shows only last 3 rows
#                    A         B         C         D
# 2013-01-04  0.721555 -0.706771 -1.039575  0.271860
# 2013-01-05 -0.424972  0.567020  0.276232 -1.087401
# 2013-01-06 -0.673690  0.113648 -1.478427  0.524988
```

DataFrame의 인덱스를 보려면 `.index` 속성을, 컬럼을 보려면 `.columns` 속성을, 안에 들어있는 numpy 데이터를 보려면 `.values` 속성을 통해 확인하면 됩니다.

```python
df.index
# DatetimeIndex(['2013-01-01', '2013-01-02', '2013-01-03', '2013-01-04',
#                '2013-01-05', '2013-01-06'],
#               dtype='datetime64[ns]', freq='D')

df.columns
# Index(['A', 'B', 'C', 'D'], dtype='object')

df.values
# [[ 0.4691, -0.2829, -1.5091, -1.1356],
#  [ 1.2121, -0.1732,  0.1192, -1.0442],
#  [-0.8618, -2.1046, -0.4949,  1.0718],
#  [ 0.7216, -0.7068, -1.0396,  0.2719],
#  [-0.425 ,  0.567 ,  0.2762, -1.0874],
#  [-0.6737,  0.1136, -1.4784,  0.525 ]]
```

`.describe()` 메소드는 생성했던 DataFrame의 간단한 통계 정보를 보여줍니다. 컬럼별로 데이터의 개수(count), 데이터의 평균 값(mean), 표준 편차(std), 최솟값(min), 4분위수(25%, 50%, 75%), 그리고 최댓값(max)들의 정보를 알 수 있습니다.

```python
df.describe()
#               A         B         C         D
# count  6.000000  6.000000  6.000000  6.000000
# mean   0.073711 -0.431125 -0.687758 -0.233103
# std    0.843157  0.922818  0.779887  0.973118
# min   -0.861849 -2.104569 -1.509059 -1.135632
# 25%   -0.611510 -0.600794 -1.368714 -1.076610
# 50%    0.022070 -0.228039 -0.767252 -0.386188
# 75%    0.658444  0.041933 -0.034326  0.461706
# max    1.212112  0.567020  0.276232  1.071804
```

`.T` 속성은 DataFrame에서 index와 column을 바꾼 형태의 DataFrame 입니다. [pandas documentation(https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.T.html)에는 `.T`를 'Transpose index and columns'와 같이 설명해 놓고 있어서 index와 column을 바꾼 후 리턴값으로 돌려주는 메소드로 착각할 수 있습니다. 따라서 `df.T()`로 호출하는 경우가 있으실 텐데, 그렇게 해보니 에러가 나는군요. 메소드가 아니라 미리 계산되어 저장되어 있는 '속성'이라는 점을 다시 강조합니다.

```python
df.T
#    2013-01-01  2013-01-02  2013-01-03  2013-01-04  2013-01-05  2013-01-06
# A    0.469112    1.212112   -0.861849    0.721555   -0.424972   -0.673690
# B   -0.282863   -0.173215   -2.104569   -0.706771    0.567020    0.113648
# C   -1.509059    0.119209   -0.494929   -1.039575    0.276232   -1.478427
# D   -1.135632   -1.044236    1.071804    0.271860   -1.087401    0.524988

df.T()
# Traceback (most recent call last):
#   File "./main.py", line 5, in __main__
#     dfT = df.T()
# TypeError: 'DataFrame' object is not callable
```

그리고 `.sort_index()`라는 메소드로 행과 열 이름을 정렬하여 나타낼 수도 있습니다. 정렬할 대상 축을 결정할 때에는 `axis`를 이용합니다. `axis=0`라고 써주면 인덱스를 기준으로 정렬하겠다는 것이고(기본값), `axis=1`라고 써주면 컬럼을 기준으로 정렬하겠다는 것입니다. 정렬의 방향은 `ascending`을 이용합니다. `ascending=True`는 오름차순 정렬을 하겠다는 것이고(기본값), `ascending=False`는 내림차순 정렬을 하겠다는 의미입니다. 다음은 컬럼에 대하여 내림차순 정렬을 하는 예제입니다.

```python
df.sort_index(axis=1, ascending=False)
#                    D         C         B         A
# 2013-01-01 -1.135632 -1.509059 -0.282863  0.469112
# 2013-01-02 -1.044236  0.119209 -0.173215  1.212112
# 2013-01-03  1.071804 -0.494929 -2.104569 -0.861849
# 2013-01-04  0.271860 -1.039575 -0.706771  0.721555
# 2013-01-05 -1.087401  0.276232  0.567020 -0.424972
# 2013-01-06  0.524988 -1.478427  0.113648 -0.673690
```

또한 DataFrame 내부에 있는 값으로 정렬할 수도 있습니다. 다음은 B 컬럼에 대해 정렬한 결과를 보여줍니다.

```python
df.sort_values(by='B')
#                    A         B         C         D
# 2013-01-03 -0.861849 -2.104569 -0.494929  1.071804
# 2013-01-04  0.721555 -0.706771 -1.039575  0.271860
# 2013-01-01  0.469112 -0.282863 -1.509059 -1.135632
# 2013-01-02  1.212112 -0.173215  0.119209 -1.044236
# 2013-01-06 -0.673690  0.113648 -1.478427  0.524988
# 2013-01-05 -0.424972  0.567020  0.276232 -1.087401
```

## 3. 데이터 선택하기 (Selection)

한 컬럼의 값들만 가져오고 싶다면 DataFrame의 맨 뒤에 `df['A']`와 같은 형태로 입력합니다. 이는 `df.A`와 동일합니다. Series의 형태로 나타나는군요.

```python
df['A']
# 2013-01-01    0.469112
# 2013-01-02    1.212112
# 2013-01-03   -0.861849
# 2013-01-04    0.721555
# 2013-01-05   -0.424972
# 2013-01-06   -0.673690
# req: D, Name: A, dtype: float64

type(df['A'])
# <class 'pandas.core.series.Series'>
```

여러분의 이해를 돕기 위해 그림으로 다시 나타내면 다음과 같습니다. (앞으로도 쭉 그림으로 한번 더 설명할게요.)

![Image](/images/2017-08-12-fig1.png "Select column A"){: .center-image}

특정 행을 가져오고 싶다면 다음과 같이 리스트와 같이 `[]`를 이용하여 슬라이싱 합니다. 또는 인덱스의 값을 직접 넣어서 슬라이싱 할 수도 있습니다. 이 때에는 처음과 끝의 인덱싱 이름이 이 모두 포함된 결과를 얻습니다.

```python
df[0:3]
#                    A         B         C         D
# 2013-01-01  0.469112 -0.282863 -1.509059 -1.135632
# 2013-01-02  1.212112 -0.173215  0.119209 -1.044236
# 2013-01-03 -0.861849 -2.104569 -0.494929  1.071804

df['20130102':'20130104']
#                    A         B         C         D
# 2013-01-02  1.212112 -0.173215  0.119209 -1.044236
# 2013-01-03 -0.861849 -2.104569 -0.494929  1.071804
# 2013-01-04  0.721555 -0.706771 -1.039575  0.271860
```

![Image](/images/2017-08-12-fig2.png "Select rows"){: .center-image}

### 이름을 이용하여 선택하기: `.loc`

라벨의 이름을 이용하여 선택할 수 있는 `.loc`를 이용할 수도 있습니다.
첫 번째 인덱스의 값인 '2013-01-01'에 해당하는 모든 컬럼의 값 가져오기.

```python
df.loc[dates[0]]
# A    0.469112
# B   -0.282863
# C   -1.509059
# D   -1.135632
# Name: 2013-01-01 00:00:00, dtype: float64
```

컬럼 'A'와 컬럼 'B'에 대한 모든 값 가져오기.

```python
df.loc[:,['A','B']]
#                    A         B
# 2013-01-01  0.469112 -0.282863
# 2013-01-02  1.212112 -0.173215
# 2013-01-03 -0.861849 -2.104569
# 2013-01-04  0.721555 -0.706771
# 2013-01-05 -0.424972  0.567020
# 2013-01-06 -0.673690  0.113648
```

인덱스 '2013-01-02'부터 '2013-01-04'까지의 컬럼 'A'와 컬럼 'B'의 값 가져오기.

```python
df.loc['20130102':'20130104',['A','B']]
#                    A         B
# 2013-01-02  1.212112 -0.173215
# 2013-01-03 -0.861849 -2.104569
# 2013-01-04  0.721555 -0.706771
```

특정 인덱스 값의 컬럼 'A', 'B' 값을 가져오기.

```python
df.loc[dates[0], ['A','B']]
# A    1.212112
# B   -0.173215
# Name: 2013-01-02 00:00:00, dtype: float64
```

특정 인덱스 값과 특정 컬럼에 있는 값 가져오기. 이는 `.at`을 이용할 수도 있습니다.

```python
df.loc[dates[0],'A']
# 0.46911229990718628

df.at[dates[0], 'A']
# 0.46911229990718628
```

### 위치를 이용하여 선택하기: `.iloc`



## 4. 결측값 다루기 (Missing Data)



## 5. 연산 (Operations)

### 통계적 지표들

평균 구하기. 일반적으로 결측치는 제외하고 연산을 합니다.

```python
df.mean()
# A   -0.004474
# B   -0.383981
# C   -0.687758
# D    5.000000
# F    3.000000
# dtype: float64
```

다른 축에 대해서 평균 구하기. `mean()` 함수의 인자로 1을 주게 되면 컬럼이 아닌 인덱스를 기준으로 연산을 합니다.

```python
df.mean(1)
# 2013-01-01    0.872735
# 2013-01-02    1.431621
# 2013-01-03    0.707731
# 2013-01-04    1.395042
# 2013-01-05    1.883656
# 2013-01-06    1.592306
# Freq: D, dtype: float64
```





## 6. 합치기 (Merging)




## 7. 묶기 (Grouping)




## 8. 변형하기 (Reshaping)




## 9. 시계열 데이터 다루기 (Time Series)




## 10. 카테고리 (Categoricals)




## 11. 그래프로 그리기 (Plotting)




## 12. 데이터 입/출력 (Getting Data In/Out)